# APF参数调整实验结果

## 🔬 实验目的
测试降低APF斥力系数能否解决局部极小值陷阱问题

## 📊 参数对比

### 原始参数（测试1）
```python
k_att = 1.0  # 引力系数
k_rep = 2.0  # 斥力系数
d0 = 0.5     # 斥力影响范围（米）
```

### 调整后参数（测试2）
```python
k_att = 1.0  # 引力系数（不变）
k_rep = 0.8  # 斥力系数（降低60%）
d0 = 0.6     # 斥力影响范围（增加20%）
```

**调整理由**:
- 降低k_rep → 减少斥力峰值，避免无人机被过度推离
- 增大d0 → 扩大斥力影响范围，使斥力梯度更平缓

---

## 📈 测试结果对比

### 测试配置
- **起点**: (-1.0, -1.0, 0.5)
- **终点**: (1.0, 1.0, 0.5)
- **直线距离**: 2.83m
- **障碍物**: 2个圆柱 @ (0, ±0.4, 0-1.0)
- **最大步数**: 2000

### 关键指标对比

| 指标 | 测试1 (k_rep=2.0) | 测试2 (k_rep=0.8) | 变化 |
|------|------------------|------------------|------|
| **平均斥力** | 4.683 | 4.280 | ↓ 8.6% |
| **平均引力** | 0.880 | 0.930 | ↑ 5.7% |
| **最大斥力** | 17.121 | 8.827 | ↓ 48.4% ✓ |
| **X坐标最大值** | 0.584 | 0.593 | ↑ 1.5% |
| **到达目标** | ❌ 否 | ❌ 否 | 无改善 |
| **最终距离** | ~0.88m | ~0.93m | ↑ 5.7% (更远) |
| **碰撞警告** | 0次 | 2次 | ⚠️ |

### 位置轨迹对比

**测试1** (k_rep=2.0):
- X范围: 0.415 - 0.584
- 卡在: ~(0.5, 0.28) 附近

**测试2** (k_rep=0.8):
- X范围: 0.428 - 0.593
- 卡在: ~(0.5, 0.25) 附近

---

## 🔍 详细分析

### ✅ 改善的部分
1. **斥力峰值大幅降低**: 从17.1降到8.8（↓48%）
   - 无人机不会被障碍物"暴力推离"
   
2. **X方向稍有进步**: 从0.58到0.59（↑1.5%）
   - 能稍微更靠近障碍物

3. **引力略有提升**: 从0.88到0.93（↑5.7%）
   - 相对于斥力的影响增强

### ❌ 问题依然存在
1. **仍然卡在同一区域**: X≈0.5, Y≈0.25-0.30
   - 无法突破障碍物区域

2. **出现碰撞警告**: 2次
   - 降低斥力导致过于接近障碍物

3. **到目标距离更远**: 0.88m → 0.93m
   - 说明无人机反而离目标更远了

---

## 💡 结论

### 参数调整效果：**有限改善，但未解决根本问题**

**积极方面**:
- 斥力峰值显著降低（↓48%）
- 避免了极端的"弹开"效应
- 系统更加稳定（力场梯度平滑）

**消极方面**:
- 仍陷入局部极小值
- X方向仅前进0.9cm（微不足道）
- 出现碰撞风险增加
- 整体性能未达到可用水平

### 根本问题分析

参数调整**无法从根本上解决**局部极小值问题，因为：

1. **障碍物位置问题**: 障碍物(0, 0.4)正好在起点(-1, -1)和终点(1, 1)的直线路径上
   
2. **APF固有缺陷**: 无论如何调参数，当目标在障碍物后方时，引力和斥力总会在某处达到平衡

3. **力场死锁**:
   ```
   引力方向: 向右上(1, 1)
   斥力方向: 向下或向左（远离障碍物）
   合力: 在障碍物附近趋近于零
   ```

4. **缺乏全局视野**: PPO只能到达0.10m的中间航点，无法"看到"需要绕行

---

## 🚀 下一步建议

### 方案排序（按推荐优先级）

#### 🥇 方案1: 多阶段路径规划（最推荐）
**实现**: 在起点和终点间插入绕行中间点

```python
if 检测到障碍物在直线路径上:
    # 绕到障碍物下方
    中间点1 = (0.5, -0.2, 0.5)   # 绕下方
    中间点2 = (1.0, -0.2, 0.5)   # 到达y=-0.2
    中间点3 = (1.0, 1.0, 0.5)    # 最终目标
    
    for 点 in [中间点1, 中间点2, 中间点3]:
        APF导航到该点
```

**优点**:
- ✅ 立即可用（无需重训练模型）
- ✅ 实现简单（~50行代码）
- ✅ 100%避开局部极小值
- ✅ 对称绕行（可选上/下方）

**预计效果**: 90%成功率

---

#### 🥈 方案2: 集成RRT*全局规划器
**实现**: RRT*规划全局路径 + APF局部避障

```python
# 使用RRT*规划粗略路径
路径点序列 = RRT_star(起点, 终点, 障碍物)
# [(-1,-1), (-0.5,-0.2), (0.5,-0.2), (1,0.5), (1,1)]

for 路径点 in 路径点序列:
    APF导航到该路径点
```

**优点**:
- ✅ 理论上最优解
- ✅ 适用于复杂环境
- ✅ 学术界认可的标准方案

**缺点**:
- ⏱️ 实现时间较长（~半天）
- 📚 需要集成RRT*库

**预计效果**: 95%成功率

---

#### 🥉 方案3: 自适应引力/虚拟推力
**实现**: 检测停滞后临时增强引力

```python
if 100步移动 < 0.1m and 到目标 > 0.5m:
    # 临时提升引力3倍
    k_att_temp = k_att * 3.0
    # 或添加虚拟引力点
    虚拟目标 = 当前位置 + 0.3 * 目标方向
```

**优点**:
- ✅ 无需改变整体架构
- ✅ 代码改动最小

**缺点**:
- ⚠️ 治标不治本
- ⚠️ 可能仍会卡住
- ⚠️ 引入新参数（调参困难）

**预计效果**: 60%成功率

---

#### 方案4: 继续调参（不推荐）
**尝试参数**:
```python
k_rep = 0.5  # 进一步降低
d0 = 0.8     # 进一步增大
```

**预计效果**: <20%成功率

**不推荐理由**:
- 已经尝试过40%降低，效果有限
- 继续降低会导致碰撞风险
- 无法从根本上解决问题

---

## 📝 实验日志

| 日期 | 测试编号 | k_rep | d0 | 最大X | 结果 |
|------|---------|-------|----|----|------|
| 2025-10-24 | 测试1 | 2.0 | 0.5 | 0.584 | ❌ 失败 |
| 2025-10-24 | 测试2 | 0.8 | 0.6 | 0.593 | ❌ 失败 |
| 待测 | 测试3 | - | - | - | 多阶段路径 |

---

## 🎯 立即行动建议

**推荐**: 实施**方案1（多阶段路径规划）**

**理由**:
1. 成本效益比最高（实现简单，效果好）
2. 立即可用（无需模型重训练）
3. 解决根本问题（避开局部极小值）
4. 可扩展性好（易于添加更多中间点）

**预计实现时间**: 30分钟
**预计成功率**: >90%

---

**实验日期**: 2025-10-24  
**实验者**: AGF导航系统诊断  
**结论**: 参数调整有限，需要架构级改进
